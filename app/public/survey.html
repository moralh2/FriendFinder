<!DOCTYPE html>
<html>

<head>
    <title>Survey</title>
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!--CDN for JQuery-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <style>
        label { 
            font-size: 1.1rem !important;
            font-style: italic;
        }
    </style>
</head>

<body>

    <div class="container">

        <div class="row">
            <div class="col s12">
                <div class="card deep-purple accent-33">
                    <div class="card-content white-text">
                        <span class="card-title">Welcome to the FriendFinder Survey</span>
                        <p>Please read each of the statements,</p>
                        <p>To then indicate the level of agreement,</p>
                        <p>Or perhaps disagreement,</p>
                        <p>With each notion presented.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <form id="survey-form" class="col s12">

                <div class="input-field col s12">
                    <input id="name" type="text" class="validate">
                    <label for="name">Name</label>
                </div>

                <div class="input-field col s12">
                    <input id="photo" type="text" class="validate">
                    <label for="photo">Photo URL</label>
                </div>

                <!-- Questions loaded here from loadQuestions() -->
                <div id="survey-questions">
                </div>

                <a id="form-submit" class="waves-effect waves-light btn">Submit</a>

            </form>
        </div>

    </div>

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <!-- Init JS Components (Select) from Materialize, listener for form post  -->
    <script type="text/javascript">

        var questions = [
            "I need coffee in my life", "I am definitely a morning person", 
            "I really like scary movies", "I prefer beer to wine",
            "I like dogs over cats", "I enjoy hiking",
            "I watch too much Netflix", "I can't wait for the final season of Game Thrones",
            "I like listening to Classical music on occassion", "I go out to the movies a lot"
        ];

        $(document).ready(function () {
            loadQuestions()
        });

        $("#form-submit").on("click", function (event) {
            event.preventDefault();

            // Will save selected options
            var optionsArray = []
            for (var i = 1; i <= questions.length; i++) {

                // Only saves first character -- 1-5, or 'C' if not selected
                questionValue = $("#question-" + i + " input.select-dropdown").val()[0];
                optionsArray.push(questionValue);
            }

            // Get name and link from form
            var nameSubmitted = $("#name").val().trim();
            var photoLinkSubmitted = $("#photo").val().trim();


            // Validate name is supplied
            if (nameSubmitted === "") {
                alert("Please enter a name");
            }

            // Validate photo URL is supplied
            else if (photoLinkSubmitted === "") {
                alert("Please enter a photo URL")
            }

            // Validate all questions were answered
            else if (optionsArray.indexOf("C") != -1) {
                alert("Please answer all the questions")
            }

            // If data is valid, convert answers to integers, and post all data
            else {
                var scoresArray = []

                // Parse string integers
                for (var j in optionsArray) {
                    scoresArray.push(parseInt(optionsArray[j]));
                }

                // Create obj for new friend
                var newFriend = {
                    name: nameSubmitted,
                    photo: photoLinkSubmitted,
                    scores: scoresArray
                };

                // Post new user
                $.post("/api/friends", newFriend, function (data) {
                    if (data) {
                        alert(JSON.stringify(data));
                    }

                    // Clear form
                    $("#name").val("");
                    $("#photo").val("");
                    loadQuestions();
                });
            }
        });

        // Use jQuery to load all the questions on the page
        function loadQuestions() {
            var formDiv = $("#survey-questions");
            formDiv.empty();
            for (var i in questions) {

                // The numId math below concatenates w/o the '+'
                var numId = +1 + +i;
                var runningId = "question-" + numId;
                var questionDiv = $("<div>").addClass("input-field col s12").attr("id", runningId);
                var selectTag = $("<select>");
                var option0 = $("<option>").text("Choose your option")
                option0.attr("disabled", true)
                option0.attr("selected", "selected")
                selectTag.append(option0);
                var defaultOptions = ["1 (Strongly Disagree)", "2", "3", "4", "5 (Strongly Agree)"]

                for (var j in defaultOptions) {
                    var option = $("<option>").text(defaultOptions[j]).val(j);
                    selectTag.append(option);
                }

                questionDiv.append(selectTag);
                var label = $("<label>").text(questions[i]);
                questionDiv.append(label);
                formDiv.append(questionDiv);
            }

            // Initialize the Materialize selects
            $("select").formSelect();
        }

    </script>

</body>

</html>